@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.apidocumentation.models.ViewModel
@import uk.gov.hmrc.apidocumentation.models.apispecification.ResourceGroup
@import uk.gov.hmrc.apidocumentation.views.helpers.{Markdown, Slugify}


@(resourceGroup: ResourceGroup, viewModel: ViewModel)

@defining(resourceGroup.name.getOrElse("")) { titleSection =>

    @if(resourceGroup.name.isDefined) {
        <div id="@Slugify(resourceGroup.name.get)">
            <h3 class="heading-medium">@resourceGroup.name.get</h3>
            @if(resourceGroup.description.isDefined) {
                <p>@Markdown(resourceGroup.description.get)</p>
            }
            <h4 class="heading-small">@titleSection resources</h4>
        </div>
    }

    <div class="endpoint_group">
        @for(res <- resourceGroup.resources) {
            @if(res.methods.nonEmpty) {
                @for((method, index) <- res.methods.zipWithIndex) {
                    @if(!method.method.equalsIgnoreCase("OPTIONS")) {
                        @defining(s"${Slugify(titleSection)}_${Slugify(method.displayName)}_${method.method.toLowerCase()}_accordion") { methodSlug =>
                            @if(index == 0) {
                                <strong id="@method.method.toUpperCase" class="govuk-tag">
                                    @method.method.toUpperCase
                                </strong>
                                <br />
                                <br />
                                <div class="method-container">
                                    @defining(res.resourcePath.split("/").toSeq) { case head :+ tail =>
                                        <code id="@{head.mkString("/")}/@tail" class="code--slim">@{head.mkString("/")}/<strong class="bold-xsmall">@tail</strong></code>
                                    }
                                </div>
                            }
                            <br />
                            <div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default">
                                <div class="govuk-accordion__section">
                                    <div class="govuk-accordion__section-header" id="@{method.displayName}">
                                        <h3 class="govuk-accordion__section-heading">
                                            <span class="govuk-accordion__section-button">
                                                @{method.displayName}
                                            </span>
                                        </h3>
                                    </div>
                                    @defining(s"${Slugify(method.displayName)}-${method.method.toLowerCase}") { contentID =>
                                        <div id="method-content" class="govuk-accordion__section-content" aria-labelledby="method-display-name">
                                            <div class="markdown-text-styles">
                                                @Markdown(method.description)
                                            </div>
                                            @resource_content(res, method, viewModel, contentID, method.securedBy.map(x => (x.`type`, x.scope)).getOrElse(("none", None)))
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    }
                }
            }
        }
    </div>
}
